================================================================================
  GUÃA SENIOR: REGISTRO DE HIJO POR TUTOR - FRONTEND
================================================================================

Equipo: Frontend Web
Backend: SafeSteps API v2.0
Fecha: Diciembre 2025
Autor: Arquitecto Backend Senior

================================================================================
  RESUMEN EJECUTIVO
================================================================================

El tutor puede registrar a sus hijos desde la interfaz web proporcionando
ÃšNICAMENTE datos bÃ¡sicos (nombre, apellido, telÃ©fono). El sistema genera
automÃ¡ticamente un cÃ³digo de vinculaciÃ³n de 6 caracteres que el hijo usarÃ¡
para acceder a su aplicaciÃ³n mÃ³vil.

IMPORTANTE:
- NO solicitar email ni password del hijo
- El hijo usarÃ¡ SOLO el cÃ³digo para hacer login en mÃ³vil
- El cÃ³digo debe mostrarse claramente al tutor despuÃ©s del registro

================================================================================
  CAMBIOS PRINCIPALES
================================================================================

ANTES (âŒ INCORRECTO):
- Se pedÃ­a email y password del hijo
- El hijo hacÃ­a login con email/password

AHORA (âœ… CORRECTO):
- Solo se pide: nombre, apellido (opcional), telÃ©fono (opcional)
- Backend genera cÃ³digo automÃ¡ticamente: Ej. "A3B7K9"
- El hijo hace login SOLO con el cÃ³digo (sin email/password)

================================================================================
  ENDPOINT: REGISTRAR HIJO
================================================================================

URL: POST http://localhost:3000/tutores/registrar-hijo
MÃ©todo: POST
AutenticaciÃ³n: Bearer Token (JWT del tutor)

--------------------------------------------------------------------------------
HEADERS
--------------------------------------------------------------------------------

Authorization: Bearer <JWT_TOKEN_DEL_TUTOR>
Content-Type: application/json

--------------------------------------------------------------------------------
REQUEST BODY
--------------------------------------------------------------------------------

{
  "nombre": "MarÃ­a",
  "apellido": "GonzÃ¡lez",     // OPCIONAL
  "telefono": "987654321"     // OPCIONAL
}

VALIDACIONES:
- nombre: REQUERIDO, mÃ­nimo 3 caracteres
- apellido: OPCIONAL, si se envÃ­a mÃ­nimo 2 caracteres
- telefono: OPCIONAL, si se envÃ­a mÃ­nimo 7 caracteres

âš ï¸ NO ENVIAR:
- email (se genera automÃ¡ticamente)
- password (se genera automÃ¡ticamente)
- latitud (solo desde app mÃ³vil del hijo)
- longitud (solo desde app mÃ³vil del hijo)

--------------------------------------------------------------------------------
RESPONSE EXITOSA (201 Created)
--------------------------------------------------------------------------------

{
  "id": 25,
  "nombre": "MarÃ­a",
  "apellido": "GonzÃ¡lez",
  "email": "hijo_k9p5m2@safesteps.temp",
  "telefono": "987654321",
  "codigoVinculacion": "K9P5M2",        â­ IMPORTANTE
  "vinculado": false,
  "tipo": "hijo",
  "ultimaconexion": "2025-12-07T10:30:00Z",
  "latitud": null,
  "longitud": null
}

CAMPOS IMPORTANTES:
- codigoVinculacion: El cÃ³digo que el tutor debe compartir con el hijo
- vinculado: false = hijo aÃºn no ha usado el cÃ³digo
- email: Temporal, NO mostrar al usuario

--------------------------------------------------------------------------------
ERRORES POSIBLES
--------------------------------------------------------------------------------

401 Unauthorized
{
  "statusCode": 401,
  "message": "Unauthorized"
}
â†’ El token JWT es invÃ¡lido o expirÃ³
â†’ AcciÃ³n: Redirigir a login

400 Bad Request
{
  "statusCode": 400,
  "message": "El nombre debe tener al menos 3 caracteres"
}
â†’ Validaciones fallidas
â†’ AcciÃ³n: Mostrar mensaje de error al usuario

500 Internal Server Error
{
  "statusCode": 500,
  "message": "Error al registrar el hijo"
}
â†’ Error del servidor
â†’ AcciÃ³n: Mostrar mensaje genÃ©rico y reintentar

================================================================================
  FLUJO COMPLETO DE USUARIO
================================================================================

PASO 1: Tutor accede a "Mis Hijos"
â”œâ”€ Click en botÃ³n "Agregar Hijo" / "Registrar Hijo"
â””â”€ Se abre formulario de registro

PASO 2: Tutor completa formulario
â”œâ”€ Nombre: [MarÃ­a]                    (REQUERIDO)
â”œâ”€ Apellido: [GonzÃ¡lez]               (OPCIONAL)
â””â”€ TelÃ©fono: [987654321]              (OPCIONAL)

âš ï¸ NO MOSTRAR campos de email ni password

PASO 3: Tutor envÃ­a formulario
â”œâ”€ Frontend valida campos localmente
â”œâ”€ Frontend hace POST a /tutores/registrar-hijo
â””â”€ Frontend muestra loader mientras espera respuesta

PASO 4: Backend procesa registro
â”œâ”€ Valida que tutor estÃ¡ autenticado (JWT)
â”œâ”€ Valida datos del formulario
â”œâ”€ Genera cÃ³digo aleatorio: "K9P5M2"
â”œâ”€ Genera email temporal: "hijo_k9p5m2@safesteps.temp"
â”œâ”€ Genera password temporal aleatorio
â”œâ”€ Crea hijo en base de datos
â””â”€ Vincula hijo con tutor (relaciÃ³n many-to-many)

PASO 5: Frontend recibe respuesta
â”œâ”€ Si Ã©xito (201): Mostrar cÃ³digo en modal/dialog
â”œâ”€ Si error (4xx/5xx): Mostrar mensaje de error
â””â”€ CÃ³digo debe ser GRANDE y VISIBLE

PASO 6: Mostrar cÃ³digo al tutor
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Hijo Registrado Exitosamente      â”‚
â”‚                                        â”‚
â”‚  MarÃ­a GonzÃ¡lez                        â”‚
â”‚                                        â”‚
â”‚  CÃ³digo de VinculaciÃ³n:                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚      K 9 P 5 M 2         â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                        â”‚
â”‚  [ğŸ“‹ Copiar]  [ğŸ“¤ Compartir]          â”‚
â”‚                                        â”‚
â”‚  Comparte este cÃ³digo con tu hijo     â”‚
â”‚  para que acceda desde su mÃ³vil       â”‚
â”‚                                        â”‚
â”‚             [Cerrar]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASO 7: Tutor comparte cÃ³digo con hijo
â”œâ”€ Via WhatsApp, SMS, verbal, etc.
â””â”€ Hijo ingresa cÃ³digo en su app mÃ³vil

PASO 8: Hijo usa cÃ³digo en mÃ³vil
â”œâ”€ Hijo abre app SafeSteps en su celular
â”œâ”€ Hijo ingresa cÃ³digo: "K9P5M2"
â”œâ”€ App hace: POST /auth/login-codigo
â”œâ”€ Backend marca hijo como "vinculado: true"
â””â”€ Hijo obtiene acceso a su cuenta

================================================================================
  IMPLEMENTACIÃ“N FRONTEND (Angular/React/Vue)
================================================================================

--------------------------------------------------------------------------------
1. FORMULARIO DE REGISTRO
--------------------------------------------------------------------------------

HTML (Estructura):

<form (submit)="onSubmit()">
  
  <!-- Nombre (Requerido) -->
  <div class="form-group">
    <label for="nombre">Nombre *</label>
    <input 
      type="text" 
      id="nombre" 
      name="nombre"
      [(ngModel)]="form.nombre"
      required
      minlength="3"
      placeholder="Ej: MarÃ­a"
    />
    <span class="error" *ngIf="errors.nombre">
      {{ errors.nombre }}
    </span>
  </div>

  <!-- Apellido (Opcional) -->
  <div class="form-group">
    <label for="apellido">Apellido (opcional)</label>
    <input 
      type="text" 
      id="apellido" 
      name="apellido"
      [(ngModel)]="form.apellido"
      minlength="2"
      placeholder="Ej: GonzÃ¡lez"
    />
  </div>

  <!-- TelÃ©fono (Opcional) -->
  <div class="form-group">
    <label for="telefono">TelÃ©fono (opcional)</label>
    <input 
      type="tel" 
      id="telefono" 
      name="telefono"
      [(ngModel)]="form.telefono"
      minlength="7"
      placeholder="Ej: 987654321"
    />
  </div>

  <!-- BotÃ³n Submit -->
  <button 
    type="submit" 
    [disabled]="loading || !isValid()"
  >
    {{ loading ? 'Registrando...' : 'Registrar Hijo' }}
  </button>

</form>

âš ï¸ NO INCLUIR:
- Campo de email
- Campo de password
- Campos de latitud/longitud

--------------------------------------------------------------------------------
2. TYPESCRIPT/JAVASCRIPT (LÃ³gica)
--------------------------------------------------------------------------------

// Modelo de datos
interface RegisterChildForm {
  nombre: string;
  apellido?: string;
  telefono?: string;
}

// Modelo de respuesta
interface ChildResponse {
  id: number;
  nombre: string;
  apellido?: string;
  email: string;
  telefono?: string;
  codigoVinculacion: string;
  vinculado: boolean;
  tipo: string;
  ultimaconexion: string;
  latitud?: number;
  longitud?: number;
}

// Componente
export class RegisterChildComponent {
  
  form: RegisterChildForm = {
    nombre: '',
    apellido: '',
    telefono: ''
  };

  loading = false;
  errors: any = {};

  constructor(
    private http: HttpClient,
    private authService: AuthService,
    private dialog: MatDialog  // Angular Material Dialog
  ) {}

  // ValidaciÃ³n local
  isValid(): boolean {
    this.errors = {};
    
    if (!this.form.nombre || this.form.nombre.trim().length < 3) {
      this.errors.nombre = 'El nombre debe tener al menos 3 caracteres';
      return false;
    }

    if (this.form.apellido && this.form.apellido.trim().length < 2) {
      this.errors.apellido = 'El apellido debe tener al menos 2 caracteres';
      return false;
    }

    if (this.form.telefono && this.form.telefono.trim().length < 7) {
      this.errors.telefono = 'El telÃ©fono debe tener al menos 7 caracteres';
      return false;
    }

    return true;
  }

  // Enviar formulario
  async onSubmit() {
    if (!this.isValid()) return;

    this.loading = true;

    try {
      // Preparar datos (limpiar campos vacÃ­os)
      const payload: any = {
        nombre: this.form.nombre.trim()
      };

      if (this.form.apellido && this.form.apellido.trim()) {
        payload.apellido = this.form.apellido.trim();
      }

      if (this.form.telefono && this.form.telefono.trim()) {
        payload.telefono = this.form.telefono.trim();
      }

      // Obtener token JWT
      const token = this.authService.getToken();

      // Llamada HTTP
      const response = await this.http.post<ChildResponse>(
        'http://localhost:3000/tutores/registrar-hijo',
        payload,
        {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        }
      ).toPromise();

      // Mostrar cÃ³digo en dialog
      this.showCodigoDialog(response);

      // Limpiar formulario
      this.form = { nombre: '', apellido: '', telefono: '' };

    } catch (error: any) {
      console.error('Error al registrar hijo:', error);
      
      if (error.status === 401) {
        alert('SesiÃ³n expirada. Por favor, inicia sesiÃ³n nuevamente.');
        // Redirigir a login
      } else if (error.status === 400) {
        alert(error.error.message || 'Datos invÃ¡lidos');
      } else {
        alert('Error al registrar hijo. Intenta nuevamente.');
      }
      
    } finally {
      this.loading = false;
    }
  }

  // Mostrar cÃ³digo en dialog
  showCodigoDialog(child: ChildResponse) {
    this.dialog.open(CodigoDialogComponent, {
      data: {
        nombre: child.nombre + (child.apellido ? ' ' + child.apellido : ''),
        codigo: child.codigoVinculacion
      },
      disableClose: true,  // No cerrar con clic fuera
      width: '400px'
    });
  }
}

--------------------------------------------------------------------------------
3. DIALOG/MODAL PARA MOSTRAR CÃ“DIGO
--------------------------------------------------------------------------------

// Componente del Dialog
export class CodigoDialogComponent {
  
  constructor(
    @Inject(MAT_DIALOG_DATA) public data: {
      nombre: string;
      codigo: string;
    },
    private dialogRef: MatDialogRef<CodigoDialogComponent>
  ) {}

  // Copiar cÃ³digo al portapapeles
  copiarCodigo() {
    navigator.clipboard.writeText(this.data.codigo);
    alert('CÃ³digo copiado al portapapeles');
  }

  // Compartir cÃ³digo (Web Share API)
  compartirCodigo() {
    if (navigator.share) {
      navigator.share({
        title: 'SafeSteps - CÃ³digo de VinculaciÃ³n',
        text: `CÃ³digo de vinculaciÃ³n para ${this.data.nombre}: ${this.data.codigo}`
      });
    } else {
      // Fallback: copiar
      this.copiarCodigo();
    }
  }

  // Cerrar dialog
  cerrar() {
    this.dialogRef.close();
    // Navegar a lista de hijos o recargar
    window.location.href = '/hijos';
  }
}

--------------------------------------------------------------------------------
4. CSS/ESTILOS SUGERIDOS
--------------------------------------------------------------------------------

/* Formulario */
.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #333;
}

.form-group input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 16px;
  transition: border-color 0.2s;
}

.form-group input:focus {
  border-color: #007bff;
  outline: none;
}

.form-group .error {
  display: block;
  margin-top: 4px;
  color: #dc3545;
  font-size: 14px;
}

/* BotÃ³n Submit */
button[type="submit"] {
  width: 100%;
  padding: 14px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
}

button[type="submit"]:hover:not(:disabled) {
  background: #0056b3;
}

button[type="submit"]:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* Dialog del CÃ³digo */
.codigo-dialog {
  text-align: center;
  padding: 24px;
}

.codigo-dialog h2 {
  color: #28a745;
  margin-bottom: 16px;
}

.codigo-display {
  background: #f8f9fa;
  border: 2px solid #007bff;
  border-radius: 12px;
  padding: 24px;
  margin: 24px 0;
}

.codigo-text {
  font-size: 36px;
  font-weight: bold;
  letter-spacing: 8px;
  color: #007bff;
  font-family: 'Courier New', monospace;
}

.codigo-actions {
  display: flex;
  gap: 12px;
  margin-top: 24px;
}

.codigo-actions button {
  flex: 1;
  padding: 12px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}

.btn-copiar {
  background: #28a745;
  color: white;
  border: none;
}

.btn-compartir {
  background: #007bff;
  color: white;
  border: none;
}

.btn-cerrar {
  background: #6c757d;
  color: white;
  border: none;
}

================================================================================
  REGENERAR CÃ“DIGO (FUNCIONALIDAD ADICIONAL)
================================================================================

ENDPOINT: POST http://localhost:3000/hijos/:id/regenerar-codigo
AutenticaciÃ³n: Bearer Token (JWT del tutor)

USO: Cuando el hijo pierde su celular o el cÃ³digo estÃ¡ comprometido

--------------------------------------------------------------------------------
REQUEST
--------------------------------------------------------------------------------

POST /hijos/25/regenerar-codigo
Authorization: Bearer <JWT_TOKEN_DEL_TUTOR>

(Sin body)

--------------------------------------------------------------------------------
RESPONSE
--------------------------------------------------------------------------------

{
  "codigoVinculacion": "N3W7C9"
}

--------------------------------------------------------------------------------
IMPLEMENTACIÃ“N
--------------------------------------------------------------------------------

async regenerarCodigo(hijoId: number) {
  const confirmacion = confirm(
    'Â¿Deseas regenerar el cÃ³digo?\n\n' +
    'âš ï¸ El cÃ³digo anterior quedarÃ¡ invÃ¡lido.\n' +
    'âœ… El nuevo cÃ³digo permitirÃ¡ acceso desde un nuevo dispositivo.'
  );

  if (!confirmacion) return;

  try {
    const token = this.authService.getToken();

    const response = await this.http.post<{ codigoVinculacion: string }>(
      `http://localhost:3000/hijos/${hijoId}/regenerar-codigo`,
      {},
      {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      }
    ).toPromise();

    // Mostrar nuevo cÃ³digo
    alert(`Nuevo cÃ³digo generado: ${response.codigoVinculacion}`);

    // Copiar al portapapeles
    navigator.clipboard.writeText(response.codigoVinculacion);

  } catch (error: any) {
    if (error.status === 401) {
      alert('No tienes permisos para regenerar este cÃ³digo');
    } else {
      alert('Error al regenerar cÃ³digo');
    }
  }
}

USO EN LA UI:

En la tarjeta de cada hijo en la lista, agregar botÃ³n:

<button (click)="regenerarCodigo(hijo.id)">
  ğŸ”„ Regenerar CÃ³digo
</button>

================================================================================
  LISTA DE HIJOS (ACTUALIZACIÃ“N)
================================================================================

ENDPOINT: GET http://localhost:3000/tutores/:id/hijos
AutenticaciÃ³n: Bearer Token (JWT del tutor)

--------------------------------------------------------------------------------
RESPONSE
--------------------------------------------------------------------------------

[
  {
    "id": 25,
    "nombre": "MarÃ­a",
    "apellido": "GonzÃ¡lez",
    "email": "hijo_k9p5m2@safesteps.temp",
    "telefono": "987654321",
    "codigoVinculacion": "K9P5M2",
    "vinculado": true,
    "ultimaconexion": "2025-12-07T14:20:00Z",
    "latitud": -12.046373,
    "longitud": -77.042754
  },
  {
    "id": 26,
    "nombre": "Juan",
    "apellido": "PÃ©rez",
    "email": "hijo_a3b7k9@safesteps.temp",
    "telefono": "555-1234",
    "codigoVinculacion": "A3B7K9",
    "vinculado": false,
    "ultimaconexion": null,
    "latitud": null,
    "longitud": null
  }
]

--------------------------------------------------------------------------------
UI SUGERIDA PARA TARJETA DE HIJO
--------------------------------------------------------------------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MG   MarÃ­a GonzÃ¡lez                 â”‚
â”‚       âœ… Vinculado                   â”‚
â”‚                                      â”‚
â”‚  ğŸ“§ hijo_k9p5m2@safesteps.temp      â”‚  â† NO MOSTRAR (solo para debug)
â”‚  ğŸ“± 987654321                        â”‚
â”‚  ğŸ•’ Hace 2 horas                     â”‚
â”‚                                      â”‚
â”‚  CÃ³digo: K9P5M2  [ğŸ“‹ Copiar]        â”‚
â”‚                                      â”‚
â”‚  [âœï¸ Editar]  [ğŸ”„ Regenerar CÃ³digo]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BADGE DE ESTADO:
- vinculado: true  â†’ Badge verde "âœ… Vinculado"
- vinculado: false â†’ Badge amarillo "â³ Pendiente"

================================================================================
  CHECKLIST DE IMPLEMENTACIÃ“N
================================================================================

BACKEND (âœ… YA ESTÃ LISTO):
[âœ…] Endpoint POST /tutores/registrar-hijo
[âœ…] Endpoint POST /hijos/:id/regenerar-codigo
[âœ…] Endpoint GET /tutores/:id/hijos
[âœ…] Validaciones de DTO (solo nombre, apellido, telÃ©fono)
[âœ…] GeneraciÃ³n automÃ¡tica de cÃ³digo
[âœ…] GeneraciÃ³n automÃ¡tica de email/password temporal
[âœ…] VinculaciÃ³n tutor-hijo

FRONTEND (âš ï¸ PENDIENTE):
[ ] Crear formulario de registro de hijo
    [ ] Campo: Nombre (requerido)
    [ ] Campo: Apellido (opcional)
    [ ] Campo: TelÃ©fono (opcional)
    [ ] NO incluir campos de email/password
    [ ] Validaciones locales

[ ] Implementar llamada HTTP POST /tutores/registrar-hijo
    [ ] Incluir JWT en header Authorization
    [ ] Manejar respuesta exitosa (201)
    [ ] Manejar errores (401, 400, 500)

[ ] Crear modal/dialog para mostrar cÃ³digo
    [ ] Mostrar cÃ³digo GRANDE y VISIBLE
    [ ] BotÃ³n "Copiar al portapapeles"
    [ ] BotÃ³n "Compartir" (Web Share API)
    [ ] BotÃ³n "Cerrar" (navega a lista de hijos)

[ ] Actualizar lista de hijos
    [ ] Mostrar cÃ³digo de vinculaciÃ³n
    [ ] Mostrar estado (vinculado/pendiente)
    [ ] NO mostrar email temporal
    [ ] BotÃ³n "Regenerar CÃ³digo"

[ ] Implementar funcionalidad de regenerar cÃ³digo
    [ ] ConfirmaciÃ³n antes de regenerar
    [ ] Llamada a POST /hijos/:id/regenerar-codigo
    [ ] Mostrar nuevo cÃ³digo
    [ ] Actualizar lista de hijos

[ ] Testing
    [ ] Probar registro con todos los campos
    [ ] Probar registro solo con nombre
    [ ] Probar validaciones de campos
    [ ] Probar regeneraciÃ³n de cÃ³digo
    [ ] Probar manejo de errores

================================================================================
  PREGUNTAS FRECUENTES (FAQ)
================================================================================

Q: Â¿Por quÃ© no se pide email ni password del hijo?
A: El hijo usarÃ¡ SOLO un cÃ³digo de 6 caracteres para acceder. Es mÃ¡s simple
   y seguro para niÃ±os. El email/password se generan automÃ¡ticamente en el
   backend solo por requisitos tÃ©cnicos de la base de datos.

Q: Â¿QuÃ© pasa con el email que devuelve el backend?
A: Es un email temporal (hijo_codigo@safesteps.temp) que NO debe mostrarse
   al usuario. Solo sirve internamente. Muestra solo el cÃ³digo.

Q: Â¿Puedo registrar un hijo sin apellido ni telÃ©fono?
A: SÃ­, solo el nombre es obligatorio. Apellido y telÃ©fono son opcionales.

Q: Â¿QuÃ© pasa si el hijo pierde su celular?
A: El tutor puede regenerar el cÃ³digo desde la interfaz web. El cÃ³digo
   anterior queda invÃ¡lido y se genera uno nuevo.

Q: Â¿El cÃ³digo expira?
A: No, el cÃ³digo no tiene expiraciÃ³n. El hijo puede usarlo cuando quiera.
   Solo se invalida si el tutor lo regenera manualmente.

Q: Â¿Puedo registrar hijos sin estar autenticado?
A: No, el tutor DEBE estar autenticado (JWT vÃ¡lido). Si el token expira,
   debe iniciar sesiÃ³n nuevamente.

Q: Â¿CÃ³mo sÃ© si el hijo ya usÃ³ el cÃ³digo?
A: El campo "vinculado" indica si el hijo ya hizo login:
   - vinculado: false â†’ CÃ³digo generado pero no usado
   - vinculado: true  â†’ Hijo ya accediÃ³ con el cÃ³digo

Q: Â¿Puedo cambiar el nombre o telÃ©fono del hijo despuÃ©s?
A: SÃ­, usa el endpoint PATCH /hijos/:id con los nuevos datos.

================================================================================
  EJEMPLOS DE CÃ“DIGO COMPLETOS
================================================================================

--------------------------------------------------------------------------------
EJEMPLO 1: Angular Component Completo
--------------------------------------------------------------------------------

// register-child.component.ts
import { Component } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { MatDialog } from '@angular/material/dialog';

@Component({
  selector: 'app-register-child',
  templateUrl: './register-child.component.html'
})
export class RegisterChildComponent {
  
  form = {
    nombre: '',
    apellido: '',
    telefono: ''
  };

  loading = false;
  errors: any = {};

  constructor(
    private http: HttpClient,
    private dialog: MatDialog
  ) {}

  isValid(): boolean {
    this.errors = {};
    
    if (!this.form.nombre?.trim() || this.form.nombre.trim().length < 3) {
      this.errors.nombre = 'El nombre debe tener al menos 3 caracteres';
      return false;
    }

    if (this.form.apellido?.trim() && this.form.apellido.trim().length < 2) {
      this.errors.apellido = 'El apellido debe tener al menos 2 caracteres';
      return false;
    }

    if (this.form.telefono?.trim() && this.form.telefono.trim().length < 7) {
      this.errors.telefono = 'El telÃ©fono debe tener al menos 7 caracteres';
      return false;
    }

    return true;
  }

  async onSubmit() {
    if (!this.isValid()) return;

    this.loading = true;

    try {
      const token = localStorage.getItem('access_token');
      
      const payload: any = {
        nombre: this.form.nombre.trim()
      };

      if (this.form.apellido?.trim()) {
        payload.apellido = this.form.apellido.trim();
      }

      if (this.form.telefono?.trim()) {
        payload.telefono = this.form.telefono.trim();
      }

      const response = await this.http.post(
        'http://localhost:3000/tutores/registrar-hijo',
        payload,
        {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        }
      ).toPromise();

      this.showCodigoDialog(response);
      this.form = { nombre: '', apellido: '', telefono: '' };

    } catch (error: any) {
      console.error('Error:', error);
      alert(error.error?.message || 'Error al registrar hijo');
    } finally {
      this.loading = false;
    }
  }

  showCodigoDialog(child: any) {
    this.dialog.open(CodigoDialogComponent, {
      data: child,
      disableClose: true,
      width: '400px'
    });
  }
}

--------------------------------------------------------------------------------
EJEMPLO 2: React Component Completo
--------------------------------------------------------------------------------

// RegisterChild.jsx
import React, { useState } from 'react';
import axios from 'axios';

export const RegisterChild = () => {
  
  const [form, setForm] = useState({
    nombre: '',
    apellido: '',
    telefono: ''
  });

  const [loading, setLoading] = useState(false);
  const [errors, setErrors] = useState({});
  const [showModal, setShowModal] = useState(false);
  const [codigo, setCodigo] = useState('');

  const validate = () => {
    const newErrors = {};

    if (!form.nombre.trim() || form.nombre.trim().length < 3) {
      newErrors.nombre = 'El nombre debe tener al menos 3 caracteres';
    }

    if (form.apellido.trim() && form.apellido.trim().length < 2) {
      newErrors.apellido = 'El apellido debe tener al menos 2 caracteres';
    }

    if (form.telefono.trim() && form.telefono.trim().length < 7) {
      newErrors.telefono = 'El telÃ©fono debe tener al menos 7 caracteres';
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validate()) return;

    setLoading(true);

    try {
      const token = localStorage.getItem('access_token');
      
      const payload = {
        nombre: form.nombre.trim()
      };

      if (form.apellido.trim()) payload.apellido = form.apellido.trim();
      if (form.telefono.trim()) payload.telefono = form.telefono.trim();

      const response = await axios.post(
        'http://localhost:3000/tutores/registrar-hijo',
        payload,
        {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        }
      );

      setCodigo(response.data.codigoVinculacion);
      setShowModal(true);
      setForm({ nombre: '', apellido: '', telefono: '' });

    } catch (error) {
      console.error('Error:', error);
      alert(error.response?.data?.message || 'Error al registrar hijo');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <h2>Registrar Hijo</h2>
      
      <form onSubmit={handleSubmit}>
        
        <div className="form-group">
          <label>Nombre *</label>
          <input
            type="text"
            value={form.nombre}
            onChange={(e) => setForm({...form, nombre: e.target.value})}
            placeholder="Ej: MarÃ­a"
          />
          {errors.nombre && <span className="error">{errors.nombre}</span>}
        </div>

        <div className="form-group">
          <label>Apellido (opcional)</label>
          <input
            type="text"
            value={form.apellido}
            onChange={(e) => setForm({...form, apellido: e.target.value})}
            placeholder="Ej: GonzÃ¡lez"
          />
          {errors.apellido && <span className="error">{errors.apellido}</span>}
        </div>

        <div className="form-group">
          <label>TelÃ©fono (opcional)</label>
          <input
            type="tel"
            value={form.telefono}
            onChange={(e) => setForm({...form, telefono: e.target.value})}
            placeholder="Ej: 987654321"
          />
          {errors.telefono && <span className="error">{errors.telefono}</span>}
        </div>

        <button type="submit" disabled={loading}>
          {loading ? 'Registrando...' : 'Registrar Hijo'}
        </button>
        
      </form>

      {showModal && (
        <CodigoModal 
          codigo={codigo} 
          onClose={() => setShowModal(false)} 
        />
      )}
    </div>
  );
};

================================================================================
  CONTACTO Y SOPORTE
================================================================================

Backend API: http://localhost:3000
DocumentaciÃ³n Backend: Ver archivos .md en el repositorio
- REGISTRO-HIJO-WEB.md
- API-REGENERAR-CODIGO-HIJO.md

Dudas o problemas:
1. Revisar esta guÃ­a completa
2. Probar endpoints con Postman/Thunder Client
3. Verificar que el token JWT es vÃ¡lido
4. Revisar console del navegador para errores

================================================================================
  FIN DE LA GUÃA
================================================================================

VersiÃ³n: 2.0
Ãšltima actualizaciÃ³n: Diciembre 2025
Estado: âœ… Backend listo para producciÃ³n
